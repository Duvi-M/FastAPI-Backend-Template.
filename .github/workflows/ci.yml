    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"

      - name: Install dependencies
        run: |
          python -m pip install -U pip
          pip install -r requirements-dev.txt

      - name: Install Postgres client
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-client

      - name: Wait for Postgres
        run: |
          for i in {1..30}; do
            pg_isready -h localhost -p 5432 -U postgres -d app_test && exit 0
            sleep 1
          done
          echo "Postgres did not become ready in time" && exit 1

      - name: Migrations (alembic)
        run: |
          python -m alembic upgrade head

      - name: Seed admin
        run: |
          ADMIN_EMAIL="admin@local.com" ADMIN_PASSWORD="admin123456" python -m scripts.seed_admin

      - name: Lint (ruff)
        run: |
          ruff check .

      - name: Tests (pytest)
        run: |
          pytest -q